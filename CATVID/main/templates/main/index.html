{% extends 'main/base.html' %}
{% load static %}

{% block title %}–ì–ª–∞–≤–Ω–∞—è - –ö–ª–∏–∫–µ—Ä –ò–≥—Ä–∞{% endblock %}

{% block content %}
<div class="game-container">
    <div class="player-stats">
        <div class="stat-card">
            <h3><i class="fas fa-coins"></i> –ú–æ–Ω–µ—Ç—ã</h3>
            <p id="coins">{{ player.coins }}</p>
        </div>
        <div class="stat-card">
            <h3><i class="fas fa-mouse"></i> –ö–ª–∏–∫–∏</h3>
            <p id="clicks">{{ player.clicks }}</p>
        </div>
        <div class="stat-card">
            <h3><i class="fas fa-bolt"></i> –°–∏–ª–∞ –∫–ª–∏–∫–∞</h3>
            <p id="click-power">{{ player.click_power }}</p>
        </div>
        <div class="stat-card">
            <h3><i class="fas fa-robot"></i> –ê–≤—Ç–æ–∫–ª–∏–∫–µ—Ä</h3>
            <p id="auto-clicker-power">{{ player.auto_clicker_power }}/—Å–µ–∫</p>
        </div>
    </div>

    <div class="clicker-area">
        <button id="click-button" class="click-button" aria-label="–ö–Ω–æ–ø–∫–∞ –∫–ª–∏–∫–∞">
            <img id="skin-image" class="images_cat_button" src="{% static 'main/skins/' %}{{ player.current_skin }}" height="250" width="250" alt="–ö–æ—Ç–∏–∫ –¥–ª—è –∫–ª–∏–∫–æ–≤" onerror="this.src=`{% static 'main/skins/cat.png' %}`">
        </button>
        <p class="hint">–ù–∞–∂–∏–º–∞–π –Ω–∞ –∫–Ω–æ–ø–∫—É, —á—Ç–æ–±—ã –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –º–æ–Ω–µ—Ç—ã!</p>
    </div>

    <div class="upgrades-section">
        <h2><i class="fas fa-arrow-up"></i> –£–ª—É—á—à–µ–Ω–∏—è</h2>

        <div class="upgrades-grid">
            {% for upgrade in upgrades %}
            <div class="upgrade-card" data-upgrade-id="{{ upgrade.id }}" data-upgrade-type="{{ upgrade.upgrade_type }}">
                <div class="upgrade-header">
                    <h3>{{ upgrade.name }}</h3>
                    <span class="upgrade-type-badge {{ upgrade.upgrade_type }}">
                        {{ upgrade.get_upgrade_type_display }}
                    </span>
                </div>

                <p class="upgrade-desc">{{ upgrade.description }}</p>

                <div class="upgrade-info">
                    <!-- –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Å—Ç–æ–∏–º–æ—Å—Ç—å -->
                    <p><i class="fas fa-coins"></i> –°—Ç–æ–∏–º–æ—Å—Ç—å:
                        <span class="cost" id="cost-{{ upgrade.id }}">
                            {{ upgrade.player_cost }}
                        </span>
                    </p>

                    <!-- –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —ç—Ñ—Ñ–µ–∫—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ -->
                    {% if upgrade.upgrade_type == 'click_power' %}
                    <p><i class="fas fa-bolt"></i> +{{ upgrade.click_power_increase }} –∫ —Å–∏–ª–µ –∫–ª–∏–∫–∞</p>
                    {% elif upgrade.upgrade_type == 'auto_clicker' %}
                    <p><i class="fas fa-robot"></i> +{{ upgrade.auto_clicker_speed }} –∫–ª–∏–∫–æ–≤/—Å–µ–∫</p>
                    {% elif upgrade.upgrade_type == 'critical_chance' %}
                    <p><i class="fas fa-star"></i> +{{ upgrade.critical_chance }}% —à–∞–Ω—Å –∫—Ä–∏—Ç–∞</p>
                    {% elif upgrade.upgrade_type == 'coin_multiplier' %}
                    <p><i class="fas fa-chart-line"></i> √ó{{ upgrade.coin_multiplier }} –º–Ω–æ–∂–∏—Ç–µ–ª—å –º–æ–Ω–µ—Ç</p>
                    {% endif %}

                    <p><i class="fas fa-chart-line"></i> –°–ª–µ–¥—É—é—â–∏–π —É—Ä–æ–≤–µ–Ω—å:
                        <span id="next-cost-{{ upgrade.id }}">
                            {{ upgrade.player_next_cost }}
                        </span>
                    </p>

                    <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å —É—Ä–æ–≤–Ω—è -->
                    <div class="level-progress">
                        <div class="progress-bar"
                             style="width: {% widthratio upgrade.player_level upgrade.max_level 100 %}">
                            <span class="progress-text">{{ upgrade.player_level }}/{{ upgrade.max_level }}</span>
                        </div>
                    </div>
                </div>

                <button class="buy-button"
                        data-upgrade-id="{{ upgrade.id }}"
                        data-cost="{{ upgrade.player_cost }}"
                        data-maxed="{% if upgrade.player_is_max_level %}1{% else %}0{% endif %}"
                        {% if upgrade.player_is_max_level or player.coins < upgrade.player_cost %}disabled{% endif %}>
                    {% if upgrade.player_is_max_level %}
                    <i class="fas fa-crown"></i> –ú–∞–∫—Å. —É—Ä–æ–≤–µ–Ω—å
                    {% elif player.coins < upgrade.player_cost %}
                    <i class="fas fa-lock"></i> –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç
                    {% else %}
                    <i class="fas fa-shopping-cart"></i> –ö—É–ø–∏—Ç—å —É–ª—É—á—à–µ–Ω–∏–µ
                    {% endif %}
                </button>
            </div>
            {% empty %}
            <p>–£–ª—É—á—à–µ–Ω–∏—è –ø–æ–∫–∞ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã. –ó–∞–π–¥–∏—Ç–µ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –∏—Ö!</p>
            {% endfor %}
        </div>
    </div>

    <!-- –°–µ–∫—Ü–∏—è —è—â–∏–∫–æ–≤ -->
    <div class="boxes-section">
        <h2><i class="fas fa-box"></i> –Ø—â–∏–∫–∏ —Å–æ —Å–∫–∏–Ω–∞–º–∏</h2>
        <p class="boxes-description">–ü–æ–∫—É–ø–∞–π—Ç–µ —è—â–∏–∫–∏, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å —Å–∫–∏–Ω—ã, –º–æ–Ω–µ—Ç—ã –∏ –∫–ª–∏–∫–∏!</p>
        
        <div class="boxes-grid">
            {% for box in boxes %}
            <div class="box-card" data-box-id="{{ box.id }}">
                <div class="box-header">
                    <h3>{{ box.name }}</h3>
                    <img src="{% static 'main/images/' %}{{ box.image }}" alt="{{ box.name }}" class="box-image" onerror="this.src='{% static 'main/images/box.svg' %}'">
                </div>
                
                <p class="box-desc">{{ box.description }}</p>
                
                <div class="box-info">
                    <p><i class="fas fa-coins"></i> –¶–µ–Ω–∞: <span class="box-price">{{ box.price }}</span> –º–æ–Ω–µ—Ç</p>
                    
                    <div class="box-drops">
                        <h4>–í–æ–∑–º–æ–∂–Ω—ã–µ –Ω–∞–≥—Ä–∞–¥—ã:</h4>
                        <ul>
                            {% for drop in box.drops.all %}
                            <li class="{% if drop.is_rare %}rare-drop{% endif %}">
                                {% if drop.item_type == 'skin' %}
                                    <i class="fas fa-palette"></i> –°–∫–∏–Ω: {{ drop.item_value }}
                                {% elif drop.item_type == 'coins' %}
                                    <i class="fas fa-coins"></i> {{ drop.item_value }} –º–æ–Ω–µ—Ç
                                {% elif drop.item_type == 'clicks' %}
                                    <i class="fas fa-mouse"></i> {{ drop.item_value }} –∫–ª–∏–∫–æ–≤
                                {% endif %}
                                <span class="drop-chance">({{ drop.drop_chance }}%)</span>
                            </li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
                
                <button class="buy-box-button" 
                        data-box-id="{{ box.id }}"
                        data-price="{{ box.price }}"
                        {% if player.coins < box.price %}disabled{% endif %}>
                    {% if player.coins < box.price %}
                        <i class="fas fa-lock"></i> –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç
                    {% else %}
                        <i class="fas fa-box-open"></i> –ö—É–ø–∏—Ç—å –∑–∞ {{ box.price }} –º–æ–Ω–µ—Ç
                    {% endif %}
                </button>
            </div>
            {% empty %}
            <p>–Ø—â–∏–∫–∏ –ø–æ–∫–∞ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã.</p>
            {% endfor %}
        </div>
    </div>
</div>

<input type="hidden" id="player-id" value="{{ player.id }}">
{% csrf_token %}
{% endblock %}

{% block scripts %}
<script src="{% static 'main/js/audio-manager.js' %}" defer></script>
<script src="{% static 'main/js/clicker.js' %}" defer></script>
<script src="{% static 'main/js/init-effects.js' %}" defer></script>
<script src="{% static 'main/js/auto_clicker.js' %}" defer></script>
<script src="{% static 'main/js/skin_manager.js' %}" defer></script>

<script>
    // Function to get cookie value
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }

    // –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –∏–≥—Ä—ã
    let gameState = {
        coins: {{ player.coins }},
        clicks: {{ player.clicks }},
        clickPower: {{ player.click_power }},
        autoClickerPower: {{ player.auto_clicker_power }},
        playerId: {{ player.id }},
        currentSkin: '{{ player.current_skin }}'
    };

    // –ü–æ–º–µ—á–∞–µ–º, —á—Ç–æ –æ—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞
    window.gameClickerInitialized = true;

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–ª–∏–∫–µ—Ä–∞
    function initializeClicker() {
        const clickButton = document.getElementById('click-button');
        const skinImage = document.getElementById('skin-image');
        
        if (clickButton) {
            clickButton.addEventListener('click', handleClick);
            clickButton.addEventListener('touchstart', handleClick, { passive: false });
        }
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å–∫–∏–Ω –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        updateSkinImage();
        
        // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–≤—Ç–æ–∫–ª–∏–∫–µ—Ä
        if (gameState.autoClickerPower > 0) {
            startAutoClicker();
        }
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–∞
    function handleClick(event) {
        event.preventDefault();
        
        // –ê–Ω–∏–º–∞—Ü–∏—è –∫–Ω–æ–ø–∫–∏
        const button = event.currentTarget;
        button.style.transform = 'scale(0.95)';
        setTimeout(() => {
            button.style.transform = 'scale(1)';
        }, 100);
        
        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∫–ª–∏–∫ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
        fetch('/click/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': getCookie('csrftoken')
            },
            body: JSON.stringify({
                player_id: gameState.playerId,
                clicks: 1
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                gameState.coins = data.coins;
                gameState.clicks = data.clicks;
                updateUI();
                
                // –≠—Ñ—Ñ–µ–∫—Ç—ã –∫–ª–∏–∫–∞
                createClickEffect(event.clientX || window.innerWidth/2, event.clientY || window.innerHeight/2);
            }
        })
        .catch(error => console.error('–û—à–∏–±–∫–∞ –∫–ª–∏–∫–∞:', error));
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
    function updateUI() {
        const coinsElement = document.getElementById('coins');
        const clicksElement = document.getElementById('clicks');
        
        if (coinsElement) coinsElement.textContent = gameState.coins.toLocaleString();
        if (clicksElement) clicksElement.textContent = gameState.clicks.toLocaleString();
    }

    // –≠—Ñ—Ñ–µ–∫—Ç –∫–ª–∏–∫–∞
    function createClickEffect(x, y) {
        const effect = document.createElement('div');
        effect.textContent = '+' + gameState.clickPower;
        effect.style.cssText = `
            position: fixed;
            left: ${x}px;
            top: ${y}px;
            color: #4CAF50;
            font-weight: bold;
            font-size: 1.5rem;
            pointer-events: none;
            z-index: 9999;
            animation: floatUp 1s ease-out forwards;
        `;
        
        document.body.appendChild(effect);
        setTimeout(() => effect.remove(), 1000);
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–∫–∏–Ω–∞
    function updateSkinImage() {
        const skinImage = document.getElementById('skin-image');
        if (skinImage && gameState.currentSkin) {
            skinImage.src = `/static/main/skins/${gameState.currentSkin}`;
        }
    }

    // –ê–≤—Ç–æ–∫–ª–∏–∫–µ—Ä
    function startAutoClicker() {
        if (gameState.autoClickerPower > 0) {
            setInterval(() => {
                fetch('/auto_click/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': getCookie('csrftoken')
                    },
                    body: JSON.stringify({
                        player_id: gameState.playerId
                    })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success && data.coins_earned > 0) {
                        gameState.coins = data.coins;
                        gameState.clicks = data.clicks;
                        updateUI();
                    }
                })
                .catch(error => console.error('–û—à–∏–±–∫–∞ –∞–≤—Ç–æ–∫–ª–∏–∫–µ—Ä–∞:', error));
            }, 1000);
        }
    }

    // –ü–æ–∫—É–ø–∫–∞ —É–ª—É—á—à–µ–Ω–∏–π
    function buyUpgrade(upgradeId, cost) {
        if (gameState.coins >= cost) {
            fetch('/buy_upgrade/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': getCookie('csrftoken')
                },
                body: JSON.stringify({
                    player_id: gameState.playerId,
                    upgrade_id: upgradeId
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    gameState.coins = data.coins;
                    gameState.clickPower = data.click_power;
                    gameState.autoClickerPower = data.auto_clicker_power;
                    updateUI();
                    location.reload(); // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ü–µ–Ω
                } else {
                    alert(data.error || '–û—à–∏–±–∫–∞ –ø–æ–∫—É–ø–∫–∏');
                }
            })
            .catch(error => console.error('–û—à–∏–±–∫–∞ –ø–æ–∫—É–ø–∫–∏:', error));
        } else {
            alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç!');
        }
    }

    // –ü–æ–∫—É–ø–∫–∞ —è—â–∏–∫–∞
    function buyBox(boxId, price) {
        console.log(`–ü–æ–ø—ã—Ç–∫–∞ –∫—É–ø–∏—Ç—å —è—â–∏–∫ ${boxId} –∑–∞ ${price} –º–æ–Ω–µ—Ç. –£ –∏–≥—Ä–æ–∫–∞: ${gameState.coins} –º–æ–Ω–µ—Ç`);
        
        if (gameState.coins >= price) {
            const button = document.querySelector(`[data-box-id="${boxId}"]`);
            if (button) {
                button.disabled = true;
                button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> –û—Ç–∫—Ä—ã–≤–∞–µ–º...';
            }
            
            console.log('–û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ –ø–æ–∫—É–ø–∫—É —è—â–∏–∫–∞...');
            
            fetch('/buy_box/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': getCookie('csrftoken')
                },
                body: JSON.stringify({
                    box_id: boxId
                })
            })
            .then(response => {
                console.log('–ü–æ–ª—É—á–µ–Ω –æ—Ç–≤–µ—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞:', response.status);
                return response.json();
            })
            .then(data => {
                console.log('–î–∞–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç–∞:', data);
                
                if (data.success) {
                    gameState.coins = data.coins;
                    updateUI();
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                    const result = data.result;
                    let message = result.message || '–ü–æ–ª—É—á–µ–Ω –ø—Ä–µ–¥–º–µ—Ç!';
                    if (result.is_rare) {
                        message = 'üåü ' + message + ' üåü';
                    }
                    alert(message);
                    
                    // –ï—Å–ª–∏ –ø–æ–ª—É—á–µ–Ω —Å–∫–∏–Ω, –æ–±–Ω–æ–≤–ª—è–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                    if (result.item_type === 'skin') {
                        gameState.currentSkin = result.item_value;
                        updateSkinImage();
                    }
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ —è—â–∏–∫–æ–≤
                    updateBoxButtons();
                } else {
                    console.error('–û—à–∏–±–∫–∞ –ø–æ–∫—É–ø–∫–∏:', data.error);
                    alert(data.error || '–û—à–∏–±–∫–∞ –ø–æ–∫—É–ø–∫–∏ —è—â–∏–∫–∞');
                }
            })
            .catch(error => {
                console.error('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏ –ø—Ä–∏ –ø–æ–∫—É–ø–∫–µ —è—â–∏–∫–∞:', error);
                alert('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏');
            })
            .finally(() => {
                // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
                if (button) {
                    updateBoxButtons();
                }
            });
        } else {
            console.log('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç –¥–ª—è –ø–æ–∫—É–ø–∫–∏');
            alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç!');
        }
    }
    
    // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–Ω–æ–ø–æ–∫ —è—â–∏–∫–æ–≤
    function updateBoxButtons() {
        document.querySelectorAll('.buy-box-button').forEach(button => {
            const price = parseInt(button.dataset.price);
            if (gameState.coins >= price) {
                button.disabled = false;
                button.innerHTML = `<i class="fas fa-box-open"></i> –ö—É–ø–∏—Ç—å –∑–∞ ${price} –º–æ–Ω–µ—Ç`;
            } else {
                button.disabled = true;
                button.innerHTML = '<i class="fas fa-lock"></i> –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç';
            }
        });
    }

    // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫
    document.addEventListener('DOMContentLoaded', function() {
        initializeClicker();
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ —É–ª—É—á—à–µ–Ω–∏–π
        document.querySelectorAll('.buy-button').forEach(button => {
            button.addEventListener('click', function() {
                const upgradeId = this.dataset.upgradeId;
                const cost = parseInt(this.dataset.cost);
                const isMaxed = this.dataset.maxed === '1';
                
                if (!isMaxed && !this.disabled) {
                    buyUpgrade(upgradeId, cost);
                }
            });
        });
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ —è—â–∏–∫–æ–≤
        document.querySelectorAll('.buy-box-button').forEach(button => {
            button.addEventListener('click', function() {
                const boxId = this.dataset.boxId;
                const price = parseInt(this.dataset.price);
                
                console.log(`–ö–ª–∏–∫ –ø–æ –∫–Ω–æ–ø–∫–µ —è—â–∏–∫–∞: ID=${boxId}, —Ü–µ–Ω–∞=${price}`);
                
                if (!this.disabled) {
                    buyBox(boxId, price);
                } else {
                    console.log('–ö–Ω–æ–ø–∫–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞');
                }
            });
        });
    });

    // CSS –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–π
    const style = document.createElement('style');
    style.textContent = `
        @keyframes floatUp {
            0% {
                opacity: 1;
                transform: translateY(0);
            }
            100% {
                opacity: 0;
                transform: translateY(-50px);
            }
        }
        
        .click-button {
            transition: transform 0.1s ease;
            cursor: pointer;
        }
        
        .click-button:active {
            transform: scale(0.95);
        }
        
        .buy-button:disabled,
        .buy-box-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
    `;
    document.head.appendChild(style);

    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö
    (function() {
        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);

        if (isMobile) {
            // –£–±–∏—Ä–∞–µ–º –≤—Å–µ hover —ç—Ñ—Ñ–µ–∫—Ç—ã –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
            document.body.classList.add('no-hover');

            // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏ –¥–≤–æ–π–Ω–æ–º —Ç–∞–ø–µ
            let lastTap = 0;
            document.addEventListener('touchend', function(e) {
                const currentTime = new Date().getTime();
                const tapLength = currentTime - lastTap;
                if (tapLength < 500 && tapLength > 0) {
                    e.preventDefault();
                }
                lastTap = currentTime;
            });
        }
    })();
</script>
{% endblock %}